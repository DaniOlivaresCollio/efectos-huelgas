{"title":"Exploración y preparación de datos","markdown":{"headingText":"Exploración y preparación de datos","containsRefs":false,"markdown":"\n<div style=\"text-align: justify\">\n\n```{r cargar-paquetes,echo=FALSE,warning=FALSE,message=FALSE}\nrm(list=ls())\n\nlibrary(pacman)\np_load(tidyverse,\n       knitr,\n       bookdown,\n       car,\n       sjmisc,\n       sjPlot,\n       sjlabelled,\n       psych,\n       kableExtra,\n       gridExtra,\n       lubridate,\n       viridis,\n       statar,\n       readxl,\n       tinytex,\n       ggrepel,\n       ggalluvial,\n       survey, \n       httr,\n       # devtools,\n       readr, \n       ggplot2, \n       labelled)\n\n# devtools::install_github(\"DiogoFerrari/occupar\",dependencies=F)\n```\n\n```{r datos,echo=FALSE}\nload(here::here(\"input/data/ELSOC_Long.RData\"))\n```\n\n```{r seleccion}\n# Seleccion de variables\ndata <- elsoc_long_2016_2022 %>%\n  select(idencuesta,                                      # identificacion encuestado\n         ola,ola_w01,ola_w02,ola_w03,                     # identificacion ola\n         ola_w04,ola_w05,ola_w06,                         # identificacion ola\n         version,muestra,tipo_atricion,estrato,           # identificacion srvy\n         segmento_disenno,ponderador02,estrato_disenno,   # identificacion srvy\n         sexo=m0_sexo,edad=m0_edad,educ=m01,              # caract sociodem\n         m02,m06,m07,m08,m10,                             # caract sociodem\n         m03,ciuo88_m03,ciuo08_m03,                       # caract ocupacional\n         m04,ciiu3_m04,ciiu4_m04,                         # caract ocupacional\n         c12_04,                                          # membresia sindicato\n         c08_03,                                          # freq participa hlgs\n         mov_valora=c20,mov_valora_otro=c20_otro,         # mov que mas valora\n         c21_01,c21_02,c21_03,c21_04,c21_05,c21_06,       # caract mov valora\n         c21_07,c21_08,c21_09,c21_10,c21_11,c22,c23,c24,  # caract mov valora\n         c13,c14_01,c14_02                                # interes politica\n         )\n\n# informacion diseno del estudio\n# data_svy <- svydesign(ids = ~segmento_disenno,weights = ~ponderador02,\n#                       data = ell,nest = TRUE,strata = ~estrato_disenno)\n```\n\nPrimero, se realiza una revisión exploratoria de las variables de interés, considerando todas las olas de la base de datos, tanto para la muestra original como la de refresco.\n\n```{r,echo=FALSE}\nn <- nrow(data)\n```\n\nSe comienza con `r n` observaciones.\n\n\n## Caracterización empleo\n\n\n### Actividad principal\n\nCon la variable ELSOC:\n\n-   `m02`. ¿Cuál de estas situaciones describe mejor su actividad principal durante el último mes?\n\nCreamos la variable `actividad`.\n\n```{r,echo=FALSE}\n# Recodficar\ndata$actividad <- car::recode(data$m02,\n                              recodes=c(\"1='Trabaja de manera remunerada con jornada completa';\n                                         2='Trabaja de manera remunerada a tiempo parcial';\n                                         3='Estudia y trabaja';\n                                         4='Solo estudia';\n                                         5='Jubilado o pensionado';\n                                         6='Desempleado, buscando trabajo';\n                                         7='Realiza tareas no remuneradas';\n                                         8='Esta enfermo o tiene una discapacidad';\n                                         9='No estudia, no trabaja y no busca trabajo';\n                                         -888=NA; \n                                         -999=NA\"),\n                              as.factor=TRUE, \n                              levels=c(\"Trabaja de manera remunerada con jornada completa\",\n                                       \"Trabaja de manera remunerada a tiempo parcial\",\n                                       \"Estudia y trabaja\",\n                                       \"Solo estudia\",\n                                       \"Jubilado o pensionado\",\n                                       \"Desempleado, buscando trabajo\",\n                                       \"Realiza tareas no remuneradas\",\n                                       \"Esta enfermo o tiene una discapacidad\",\n                                       \"No estudia, no trabaja y no busca trabajo\"))\n\n# Tabla de frecuencias y porcentajes\nsjt.xtab(data$actividad, data$ola,\n         show.col.prc = TRUE, \n         var.labels = c(\"Actividad\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes de Actividad principal, por ola\") \n```\n\nSe continua con una base de datos filtrada dejando solo a las personas ocupadas de acuerdo con las siguientes categorías de actividad principal:\n\n-   `m02==1`: Trabaja de manera remunerada con jornada completa\n-   `m02==2`: Trabaja de manera remunerada a tiempo parcial\n-   `m02==3`: Estudia y trabaja\n\n```{r,echo=FALSE}\n# Filtrar para ocupados\ndata <- filter(data, actividad %in% c(\"Trabaja de manera remunerada con jornada completa\",\n                                      \"Trabaja de manera remunerada a tiempo parcial\",\n                                      \"Estudia y trabaja\"))\n```\n\n```{r,echo=FALSE}\nn <- nrow(data)\n```\n\nQuedan `r n` observaciones.\n\n\n### Full time\n\nSe crea una nueva variable binaria llamada `full_time` para identificar a aquellas personas que:\n\n- `full_time==1`: Trabajan de manera remunerada con jornada completa\n- `full_time==0`: Trabajan de manera remunerada a tiempo parcial, o trabajan y estudian\n\n```{r,echo=FALSE}\n# Crear variable binaria: full-time\ndata <- mutate(data,\n               full_time=if_else(actividad == \"Trabaja de manera remunerada con jornada completa\",1,0))\n\n# Tabla de frecuencias y porcentajes\nsjt.xtab(data$full_time,data$ola,\n         show.col.prc=TRUE, \n         var.labels=c(\"Full-time\",\"Ola\"),\n         show.summary=FALSE,\n         title=\"Frecuencias y porcentajes de Trabajadores/as con jornada completa, por ola\") \n```\n\n\n### Relación de empleo\n\nCon la variable ELSOC:\n\n-   `m07`. En su actual ocupación usted trabaja como:\n\nCreamos la variable `rel_empleo`.\n\n```{r,echo=FALSE}\n# Recodficar\ndata <- data %>%\n  mutate(rel_empleo=car::recode(m07,\n                                recodes=c(\"1='Empleado u obrero en empresa privada';\n                                           2='Empleado u obrero del sector público';\n                                           3='Miembro de las Fuerzas Armadas y de Orden';\n                                           4='Patrón/a o empleador/a';\n                                           5='Trabaja solo, no tiene empleados';\n                                           6='Familiar no remunerado';\n                                           7='Servicio doméstico';\n                                           -888=NA; \n                                           -999=NA\"),\n                                as.factor=TRUE, # convertir a factor\n                                levels=c(\"Empleado u obrero en empresa privada\",\n                                         \"Empleado u obrero del sector público\",\n                                         \"Miembro de las Fuerzas Armadas y de Orden\",\n                                         \"Patrón/a o empleador/a\",\n                                         \"Trabaja solo, no tiene empleados\",\n                                         \"Familiar no remunerado\",\n                                         \"Servicio doméstico\"))) # ordenar niveles\n\n# Tabla de frecuencias y porcentajes 2 dígitos\nsjt.xtab(data$rel_empleo, data$ola,\n         show.col.prc = TRUE,\n         var.labels = c(\"Relación de empleo\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes de la Relación de empleo, por ola\")\n```\n\nLa variable de relación de empleo (`rel_empleo` ex `m07`), solamente está presente en las olas 2016, 2018 y 2021. Por lo tanto, se duplicarán los datos de relación de empleo para los años siguientes, es decir, en 2017 se pondrán los valores de 2016, y así sucesivamente.\n\n```{r,echo=FALSE}\n# Crear una columna con la variable \"rel_empleo\" adelantada una ola\ndata <- data %>%\n  # arrange(idencuesta, ola) %>%  # Ordena por id y ola, por si acaso no está ordenado\n  group_by(idencuesta) %>%        # Agrupa por id para trabajar en cada individuo\n  mutate(rel_empleo_lagged=lag(as.character(rel_empleo),n=1)) %>%  # Desplaza \"rel_empleo\" a la siguiente ola, \n                                                                   # conviertiendo el factor en character temporalmente\n  ungroup()\n\n# Rellenar los valores NA en la variable original\ndata <- data %>%\n  mutate(rel_empleo=ifelse(!is.na(rel_empleo),as.character(rel_empleo),rel_empleo_lagged)) %>%  # Si rel empleo es NA, sustituir con el valor de la ola anterior y asegurarse que actividad esté en formato carácter\n  mutate(rel_empleo=factor(rel_empleo)) %>%  # Convertir de nuevo a factor\n  select(-rel_empleo_lagged)                 # Elimina la columna temporal\n```\n\nSe presentan las frecuencias y porcentajes de la relación de empleo, por ola.\n\n```{r,echo=FALSE}\n# Tabla de frecuencias y porcentajes\nsjt.xtab(data$rel_empleo, data$ola,\n         show.col.prc = TRUE,\n         var.labels = c(\"Relación de empleo\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes de la Relación de empleo, por ola\")\n```\n\nSe continua con una base de datos filtrada dejando solo a las personas ocupadas empleadas o auto empleadas de acuerdo con las siguientes categorías de la relación de empleo:\n\n-   `m07==1`: Empleado u obrero en empresa privada\n-   `m07==2`: Empleado u obrero del sector público\n-   `m07==5`: Trabaja solo, no tiene empleados\n-   `m07==6`: Familiar no remunerado\n-   `m07==7`: Servicio doméstico\n\nDejando afuera:\n\n-   `m07==3`: Miembro de las Fuerzas Armadas y de Orden\n-   `m07==4`: Patrón/a o empleador/a\n\n```{r,echo=FALSE}\n# Filtrar para trabajadores y self-employed\ndata <- filter(data, rel_empleo %in% c(\"Empleado u obrero en empresa privada\",\n                                       \"Empleado u obrero del sector público\",\n                                       \"Trabaja solo, no tiene empleados\",\n                                       \"Familiar no remunerado\",\n                                       \"Servicio doméstico\"))\n```\n\n```{r}\nn <- nrow(data)\n```\n\nQuedan `r n` observaciones.\n\n\n### Ocupación\n\nLa variable ELSOC:\n\n-   `m03`. ¿Cuál es su ocupación u oficio actual? Describa sus principales tareas y funciones en el puesto de trabajo actual\n\nSe encuentra codificada de acuerdo con la CIUO88 para el año 2016, y CIUO08 para los años 2018 y 2021.\n\n-   `ciuo88_m03`: CIUO (1988) del entrevistado\n-   `ciuo08_m03`: CIUO (2008) del entrevistado\n\nPor lo tanto, se realiza una recodificación creando una nueva variable donde están todas las olas homolagadas a la CIUO08, `isco08`. \n\n```{r,echo=FALSE,message=FALSE}\n# Carga bbdd con comparacion 88 y 08\nisco08_88 <- read_excel(here::here(\"input/isco08-88.xls\"))\nisco08_88 <- isco08_88 %>%\n  rename(isco08=`ISCO 08 Code`,isco88=`ISCO-88 code`)\n\n# Exploración\nvalores_repetidos <- table(isco08_88$isco88) # Contar los valores repetidos en la variable\nvalores_repetidos <- valores_repetidos[valores_repetidos > 1]\n\nvalores_repetidos <- table(isco08_88$isco08) # Contar los valores repetidos en la variable\nvalores_repetidos <- valores_repetidos[valores_repetidos > 1]\n\n# CIUO - ISCO: Recodificación 88->08 4 digitos en datos elsoc\nindices <- match(data$ciuo88_m03,isco08_88$isco88)\ndata$ciuo08_rec <- isco08_88$isco08[indices]\ndata$ciuo08_rec <- as.numeric(data$ciuo08_rec) # es solo la recodificación de las que eran 88 en data, es decir, año 2016\n\n# Creación variable isco08 con ciuo08_m03 y ciuo08_rec (ex ciuo88_m03) 4 digitos\ndata$isco08 <- ifelse(!is.na(data$ciuo08_rec),data$ciuo08_rec,data$ciuo08_m03) # es la unión en una variable de todo en 08\n```\n\nSin embargo, esta variable también se presenta solamente en las olas 2016, 2018 y 2021. Por lo que, se duplicarán los datos de ocupación para los años siguientes, es decir, en 2017 se pondrán los valores de 2016, y así sucesivamente.\n\n```{r,echo=FALSE}\n# Crear una columna con la variable \"isco08\" adelantada una ola\ndata <- data %>%\n  # arrange(idencuesta, ola) %>%  # Ordena por id y ola, por si acaso no está ordenado\n  group_by(idencuesta) %>%        # Agrupa por id para trabajar en cada individuo\n  mutate(isco08_lagged=lag(isco08,n=1)) %>%  # Desplaza \"isco08\" a la siguiente ola\n  ungroup()\n\n# Rellenar los valores NA en la variable original\ndata <- data %>%\n  mutate(isco08=ifelse(!is.na(isco08),isco08,isco08_lagged)) %>%  # Si isco08 es NA, sustituir con el valor de la ola anterior \n  select(-isco08_lagged)                 # Elimina la columna temporal\n```\n\nSe crean dos nuevas variables `isco08_1d` y `isco08_2d`, con 1 y 2 dígitos respectivamente. Se presentan las frecuencias y porcentajes con uno y dos dígitos.\n\n```{r,echo=FALSE}\n# CIUO - ISCO: creación de variables con 1 dígito\ndata$isco08_1d <- as.character(data$isco08)\ndata$isco08_1d <- substr(data$isco08_1d,1,1)\ndata$isco08_1d <- as.numeric(data$isco08_1d)\n\n# CIUO - ISCO: creación de variables con 2 dígitos\ndata$isco08_2d <- as.character(data$isco08)\ndata$isco08_2d <- substr(data$isco08_2d,1,2)\ndata$isco08_2d <- as.numeric(data$isco08_2d)\n\n# Tabla de frecuencias y porcentajes 1 dígito\nsjt.xtab(data$isco08_1d, data$ola,\n         show.col.prc = TRUE, \n         var.labels = c(\"CIUO08\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes de Ocupación con 1 dígito, por ola\")\n\n# Tabla de frecuencias y porcentajes 2 dígitos\nsjt.xtab(data$isco08_2d, data$ola,\n         show.col.prc = TRUE, \n         var.labels = c(\"CIUO08\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes de Ocupación con 2 dígitos, por ola\")\n```\n\n\n<!-- Recodificación con paquete `occupar`, ver el [enlace](https://github.com/DiogoFerrari/occupar). -->\n\n```{r,echo=FALSE}\n# data$ciuo08_rec2 <- occupar::isco88to08(data$ciuo88_m03)\n# data$isco08_2 <- ifelse(!is.na(data$ciuo08_rec2),data$ciuo08_rec2,data$ciuo08_m03)\n# \n# data$isco08_2d2 <- as.character(data$isco08_2)\n# data$isco08_2d2 <- substr(data$isco08_2d2,1,2)\n# data$isco08_2d2 <- as.numeric(data$isco08_2d2)\n# \n# sjt.xtab(data$isco08_2d2, data$ola,\n#          show.col.prc = TRUE, \n#          var.labels = c(\"CIUO08\",\"Ola\"),\n#          show.summary = FALSE,\n#          title = \"Frecuencias y porcentajes de Ocupación con 2 dígitos, por ola\")\n```\n\n\n### Nivel de cualificación\n\nSe crea una nueva variable con el Nivel de cualificación, llamada `cualificacion`, de acuerdo con la variable CIUO08 de 2 dígitos `isco08_2d`, siguiendo el criterio:\n\n-   Expertos (Experts): 11 a 34 con universitaria completa o más\n-   Calificados (Skilled): 11 a 34 con universitaria incompleta o menos, y 35,41,42,43,44,53, y 51,54,61,62,71,72,73,74,75,81 con media completa o más.\n-   No calificados (Unskilled): 51,54,61,62,71,72,73,74,75,81 con media incompleta o menos, y 52,61,63,75,82,83,90+\n\n```{r,echo=FALSE}\n# Creación variable Nivel de cualificación\ndata <- mutate(data,\n               cualificacion = case_when(isco08_2d <= 34 & educ >= 9 ~ \"Experts\",\n                                         isco08_2d <= 34 & educ < 9 ~ \"Skilled\",\n                                         isco08_2d == 35 ~ \"Skilled\",\n                                         isco08_2d >= 41 & isco08_2d <= 44 ~ \"Skilled\",\n                                         isco08_2d == 53 ~ \"Skilled\",\n                                         isco08_2d == 51 & educ <= 5 ~ \"Unskilled\",\n                                         isco08_2d == 51 & educ > 5 ~ \"Skilled\",\n                                         isco08_2d == 54 & educ <= 5 ~ \"Unskilled\",\n                                         isco08_2d == 54 & educ > 5 ~ \"Skilled\",\n                                         isco08_2d == 61 & educ <= 5 ~ \"Unskilled\",\n                                         isco08_2d == 61 & educ > 5 ~ \"Skilled\",\n                                         isco08_2d == 62 & educ <= 5 ~ \"Unskilled\",\n                                         isco08_2d == 62 & educ > 5 ~ \"Skilled\",\n                                         isco08_2d == 71 & educ <= 5 ~ \"Unskilled\",\n                                         isco08_2d == 71 & educ > 5 ~ \"Skilled\",\n                                         isco08_2d == 72 & educ <= 5 ~ \"Unskilled\",\n                                         isco08_2d == 72 & educ > 5 ~ \"Skilled\",\n                                         isco08_2d == 73 & educ <= 5 ~ \"Unskilled\",\n                                         isco08_2d == 73 & educ > 5 ~ \"Skilled\",\n                                         isco08_2d == 74 & educ <= 5 ~ \"Unskilled\",\n                                         isco08_2d == 74 & educ > 5 ~ \"Skilled\",\n                                         isco08_2d == 75 & educ <= 5 ~ \"Unskilled\",\n                                         isco08_2d == 75 & educ > 5 ~ \"Skilled\",\n                                         isco08_2d == 81 & educ <= 5 ~ \"Unskilled\",\n                                         isco08_2d == 81 & educ > 5 ~ \"Skilled\",\n                                         isco08_2d == 52 ~ \"Unskilled\",\n                                         isco08_2d == 61 ~ \"Unskilled\",\n                                         isco08_2d == 63 ~ \"Unskilled\",\n                                         isco08_2d == 75 ~ \"Unskilled\",\n                                         isco08_2d == 82 ~ \"Unskilled\",\n                                         isco08_2d == 83 ~ \"Unskilled\",\n                                         isco08_2d == 90 ~ \"Unskilled\"))\n\n# Tabla de frecuencias y porcentajes 2 dígitos\nsjt.xtab(data$cualificacion, data$ola,\n         show.col.prc = TRUE, \n         var.labels = c(\"Nivel de cualificación\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes del Nivel de Cualificación, por ola\")\n```\n\n\n### Rama de Actividad Económica\n\nLa variable ELSOC:\n\n-   `m04`. ¿A qué rubro o giro de actividad se dedica principalmente la empresa, institución o negocio para la cual usted trabaja?\n\nSe encuentra codificada de acuerdo con la CIIU3 para el año 2016, y CIIU4 para los años 2018 y 2021.\n\n-   `ciiu3_m04`: CIIU (III version) del entrevistado\n-   `ciiu4_m04`: CIIU (IV version) del entrevistado\n\nPor lo tanto, se realiza una recodificación generando una nueva variable donde están todas las olas homolagadas a la CIIU4, `isic4`.\n\n```{r,echo=FALSE,message=FALSE}\n# Recodificar variable CIIU 3 para que queden de 4 dígitos\ndata$ciiu3 <- sprintf(\"%04d\",data$ciiu3_m04)\n\n# Recodificar variable CIIU 4 para que queden de 4 dígitos\ndata$ciiu4 <- sprintf(\"%04d\",data$ciiu4_m04)\n\n# Creación de variable CIIU 4 con CIIU 3\n## Carga bbdd con comparacion 31 y 4\nisic4_isic31 <- read_csv(here::here(\"input/ISIC4_ISIC31.txt\"))\n\n## Recodificación CIIU 3 -> CIIU 4\nindices <- match(data$ciiu3,isic4_isic31$ISIC31code)\ndata$ciiu4_rec <- isic4_isic31$ISIC4code[indices]\n\n# Creación variable isic4 con ciiu4 y ciiu4_rec (ex ciiu3) 4 digitos\ndata$isic4 <- ifelse(!is.na(data$ciiu4_rec),data$ciiu4_rec,data$ciiu4) # es la unión en una variable de todo en ciiu4\n```\n\nSin embargo, esta variable también se presenta solamente en las olas 2016, 2018 y 2021. Por lo que, se duplicarán los datos de ocupación para los años siguientes, es decir, en 2017 se pondrán los valores de 2016, y así sucesivamente.\n\n```{r,echo=FALSE}\n# Crear una columna con la variable \"isic4\" adelantada una ola\ndata <- data %>%\n  # arrange(idencuesta, ola) %>%  # Ordena por id y ola, por si acaso no está ordenado\n  group_by(idencuesta) %>%        # Agrupa por id para trabajar en cada individuo\n  mutate(isic4_lagged=lag(isic4,n=1)) %>%  # Desplaza \"isic4\" a la siguiente ola\n  ungroup()\n\n# Rellenar los valores NA en la variable original\ndata <- data %>%\n  mutate(isic4=ifelse(!is.na(isic4),isic4,isic4_lagged)) %>%  # Si isic4 es NA, sustituir con el valor de la ola anterior \n  select(-isic4_lagged)                 # Elimina la columna temporal\n```\n\nAdemás se crea la variable `isic4_2d` con 2 dígitos, y la variable `rama` con la agrupación del CIIU4 de dos dígitos en ramas de la actividad económica. Se presentan las frecuencias y porcentajes de la Rama de Actividad Económica, por ola.\n\n```{r,echo=FALSE}\n# CIIU 4: creación de variable con 2 dígitos\ndata$isic4_2d <- substr(data$isic4,1,2)\ndata$isic4_2d <- as.numeric(data$isic4_2d)\n\n# Creación de variable con letra\ndata <- mutate(data,\n               rama = case_when(isic4_2d <= 03 ~ \"A\",\n                                isic4_2d >= 05 & isic4_2d <= 09 ~ \"B\",\n                                isic4_2d >= 10 & isic4_2d <= 33 ~ \"C\",\n                                isic4_2d == 35 ~ \"D\",\n                                isic4_2d >= 36 & isic4_2d <= 39 ~ \"E\",\n                                isic4_2d >= 41 & isic4_2d <= 43 ~ \"F\",\n                                isic4_2d >= 45 & isic4_2d <= 47 ~ \"G\",\n                                isic4_2d >= 49 & isic4_2d <= 53 ~ \"H\",\n                                isic4_2d >= 55 & isic4_2d <= 56 ~ \"I\",\n                                isic4_2d >= 58 & isic4_2d <= 63 ~ \"J\",\n                                isic4_2d >= 64 & isic4_2d <= 66 ~ \"K\",\n                                isic4_2d == 68 ~ \"L\",\n                                isic4_2d >= 69 & isic4_2d <= 75 ~ \"M\",\n                                isic4_2d >= 77 & isic4_2d <= 82 ~ \"N\",\n                                isic4_2d == 84 ~ \"O\",\n                                isic4_2d == 85 ~ \"P\",\n                                isic4_2d >= 86 & isic4_2d <= 88 ~ \"Q\",\n                                isic4_2d >= 90 & isic4_2d <= 93 ~ \"R\",\n                                isic4_2d >= 94 & isic4_2d <= 96 ~ \"S\",\n                                isic4_2d >= 97 & isic4_2d <= 98 ~ \"T\",\n                                isic4_2d == 99 ~ \"U\"))\n\n# Tabla de frecuencias y porcentajes 2 dígitos\nsjt.xtab(data$rama, data$ola,\n         show.col.prc = TRUE, \n         var.labels = c(\"Rama de Actividad Económica\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes de la Rama de Actividad Económica, por ola\")\n```\n\n\n```{r,echo=FALSE}\n# clase <- data %>% \n#   select(idencuesta,ola,class,class_2)\n# \n# clase <- clase %>%\n#   drop_na(ola,class,class_2,idencuesta)\n# \n# clase <- clase %>% \n#   group_by(ola) %>% \n#   mutate(prop = n()/4537) %>% \n#   ungroup()\n# \n# ggplot(data = clase,\n#        aes(y = prop,\n#            x = ola,\n#            fill = class_2, stratum=class_2, alluvium=idencuesta)) +\n#   # geom_alluvium(aes(fill = rama), width = 0.2) +\n#   ggalluvial::geom_stratum(linetype = 0) +\n#   geom_text(stat = \"stratum\", aes(label = after_stat(stratum))) +\n#   scale_x_discrete(limits = c(\"2016\",\"2017\", \"2018\",\"2019\",\"2021\"), expand = c(.1, .1)) +\n#   labs(title = \"Gráfico Aluvial de la Variable 'Rama' a lo Largo de las Olas\",\n#        x = \"Ola\",\n#        y = \"Número de Encuestados\") +\n#   theme_bw() +\n#   ggalluvial::geom_flow(alpha = .66)\n```\n\n```{r,echo=FALSE}\n# ggplot(data = clase,\n#        aes(y = prop,\n#            x = ola,\n#            axis2 = class_2,\n#            alluvium = idencuesta,\n#            stratum = class_2,\n#            fill = class_2)) +\n#   theme_bw() +\n#   ggalluvial::geom_flow(alpha = 0.66) +\n#   ggalluvial::geom_stratum(width = 0.55, linetype=0) +\n#   geom_text(stat = \"stratum\", aes(label = after_stat(stratum)), color = \"black\", size = 3) +\n#   scale_x_discrete(limits = c(\"2016\", \"2017\", \"2018\", \"2019\", \"2021\"), expand = c(.1, .1)) +\n#   labs(title = \"Gráfico Aluvial de la Variable 'Rama' a lo Largo de las Olas\",\n#        x = \"Ola\",\n#        y = \"Proporción\") +\n#   theme(legend.position = \"bottom\")\n```\n\nRama 2:\n\n-   Se unen *B* y *C*\n-   Se unen *D*, *E* y *F*\n-   Se unen *G* y *I*\n-   Se unen *J*, *K*, *L*, *M* y *N*\n-   Se unen *P* y *Q*\n-   Se unen *R*, *S* y *U*\n\n```{r,echo=FALSE}\n# Creación de variable posición de clase\ndata <- mutate(data,\n               rama_2=case_when(rama == \"A\" ~ \"A\",\n                                rama == \"B\" | rama == \"C\" ~ \"BC\",\n                                rama == \"D\" | rama == \"E\" | rama == \"F\" ~ \"DEF\",\n                                rama == \"G\" | rama == \"I\" ~ \"GI\",\n                                rama == \"H\" ~ \"H\",\n                                rama == \"J\" | rama == \"K\" | rama == \"L\" | rama == \"M\" | rama == \"N\" ~ \"JKLMN\",\n                                rama == \"O\" ~ \"O\",\n                                rama == \"P\" | rama == \"Q\" ~ \"PQ\",\n                                rama == \"R\" | rama == \"S\" | rama == \"U\" ~ \"RSU\",\n                                rama == \"T\" ~ \"T\"))\n\n# data$rama_2 <- factor(data$rama_2,\n#                       levels = c(\"Self-employed\",\n#                                  \"Expert managers\",\n#                                  \"Experts\",\n#                                  \"Supervisors\",\n#                                  \"Workers\"))\n\n# Tabla de frecuencias y porcentajes 2 dígitos\nsjt.xtab(data$rama_2, data$ola,\n         show.col.prc = TRUE, \n         var.labels = c(\"Rama 2\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes de la Rama 2, por ola\")\n```\n\n### Supervisión\n\n-   `m06`. En su trabajo, ¿a cuántas personas supervisa usted?\n\nSe recodifica en una nueva variable, `supervisa`, donde:\n\n-   `supervisa==1`: Supervisa a una o más personas\n-   `supervisa==0`: No supervisa\n\n```{r}\n# Crear variable supervisa==1, no supervisa==0\ndata <- data %>%\n  mutate(supervisa=case_when(m06 == 0 ~ 0,\n                             m06 >= 1 ~ 1,\n                             m06 == -888 ~ NA,\n                             m06 == -999 ~ NA))\n\n# Tabla de frecuencias y porcentajes 2 dígitos\nsjt.xtab(data$supervisa, data$ola,\n         show.col.prc = TRUE, \n         var.labels = c(\"Supervisa\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes de variable Supervisa, por ola\")\n```\n\n### Class\n\nSe crea la variable posición de clase (class) con 7 categorías:\n\n1.  Self-employed\n2.  Expert managers: expertos que supervisan\n3.  Experts: expertos que no supervisan\n4.  Skilled supervisors: skilled que supervisan\n5.  Skilled workers: skilled que no supervisan\n6.  Unskilled supervisors: unskilled que supervisan\n7.  Workers: skilled que no supervisan\n\n```{r}\n# Creación de variable posición de clase\ndata <- mutate(data,\n               class=case_when(rel_empleo == \"Trabaja solo, no tiene empleados\" ~ \"Self-employed\",\n                               cualificacion == \"Experts\" & supervisa == 1 ~ \"Expert managers\",\n                               cualificacion == \"Experts\" & supervisa == 0 ~ \"Experts\",\n                               cualificacion == \"Skilled\" & supervisa == 1 ~ \"Skilled supervisors\",\n                               cualificacion == \"Skilled\" & supervisa == 0 ~ \"Skilled workers\",\n                               cualificacion == \"Unskilled\" & supervisa == 1 ~ \"Unskilled supervisors\",\n                               cualificacion == \"Unskilled\" & supervisa == 0 ~ \"Workers\"))\n\ndata$class <- factor(data$class,\n                     levels = c(\"Self-employed\",\n                                \"Expert managers\",\n                                \"Experts\",\n                                \"Skilled supervisors\",\n                                \"Skilled workers\",\n                                \"Unskilled supervisors\",\n                                \"Workers\"))\n\n# Tabla de frecuencias y porcentajes 2 dígitos\nsjt.xtab(data$class, data$ola,\n         show.col.prc = TRUE, \n         var.labels = c(\"Posición de clase\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes de la Posición de clase, por ola\")\n```\n\nClass 2:\n\n-   Se unen *Skilled supervisors* y *Unskilled supervisors*\n-   Se unen *Skilled workers* y *Workers*\n\n```{r}\n# Creación de variable posición de clase\ndata <- mutate(data,\n               class_2=case_when(class == \"Self-employed\" ~ \"Self-employed\",\n                                 class == \"Expert managers\" ~ \"Expert managers\",\n                                 class == \"Experts\" ~ \"Experts\",\n                                 class == \"Skilled supervisors\" | class == \"Unskilled supervisors\" ~ \"Supervisors\",\n                                 class == \"Skilled workers\" | class == \"Workers\" ~ \"Workers\"))\n\ndata$class_2 <- factor(data$class_2,\n                       levels = c(\"Self-employed\",\n                                  \"Expert managers\",\n                                  \"Experts\",\n                                  \"Supervisors\",\n                                  \"Workers\"))\n\n# Tabla de frecuencias y porcentajes 2 dígitos\nsjt.xtab(data$class_2, data$ola,\n         show.col.prc = TRUE, \n         var.labels = c(\"Posición de clase 2\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes de la Posición de clase 2, por ola\")\n```\n\n### Temporalidad del trabajo\n\n-   m08. Su trabajo o negocio principal es de tipo:\n\n```{r}\n# Recodficar\ndata <- data %>%\n  mutate(temp_trabajo=car::recode(m08,\n                                  recodes=c(\"1='Permanente';\n                                             2='De temporada o estacional';\n                                             3='Ocasional o eventual';\n                                             4='A prueba';\n                                             5='Por plazo o tiempo determinado';\n                                             -888=NA; \n                                             -999=NA\"),\n                                  as.factor=TRUE, # convertir a factor\n                                  levels=c(\"Permanente\",\n                                           \"De temporada o estacional\",\n                                           \"Ocasional o eventual\",\n                                           \"A prueba\",\n                                           \"Por plazo o tiempo determinado\"))) # ordenar niveles\n\n# Tabla de frecuencias y porcentajes\nsjt.xtab(data$temp_trabajo, data$ola,\n         show.col.prc = TRUE, \n         var.labels = c(\"Temporalidad\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes de la Temporalidad del trabajo, por ola\")\n```\n\n### Open-ended\n\nSe crea una nueva variable binaria llamada *open-ended* para identificar a aquellas personas que:\n\n-   Trabajan de manera permanente\n-   No trabajan de manera permanente\n\n```{r}\n# Crear variable binaria: open-ended\ndata <- mutate(data,\n               open_ended=if_else(temp_trabajo==\"Permanente\",1,0))\n\n# Tabla de frecuencias y porcentajes\nsjt.xtab(data$open_ended,data$ola,\n         show.col.prc=TRUE, \n         var.labels=c(\"Open-ended\",\"Ola\"),\n         show.summary=FALSE,\n         title=\"Frecuencias y porcentajes de Trabajadores/as permanentes, por ola\") \n```\n\n### Tipo de Contrato\n\n-   m10. En su trabajo principal, ¿tiene contrato de trabajo escrito?\n\n```{r}\n# Recodficar\ndata <- data %>%\n  mutate(contrato=car::recode(m10,\n                              recodes=c(\"1='Sí, lo firmé';\n                                         2='Sí, pero no lo he firmado';\n                                         3='No tengo';\n                                         -888=NA; \n                                         -999=NA\"),\n                              as.factor=TRUE, # convertir a factor\n                              levels=c(\"Sí, lo firmé\",\n                                       \"Sí, pero no lo he firmado\",\n                                       \"No tengo\"))) # ordenar niveles\n\n# Tabla de frecuencias y porcentajes \nsjt.xtab(data$contrato, data$ola,\n         show.col.prc = TRUE, \n         var.labels = c(\"Tipo de contrato\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes del Tipo de contrato, por ola\")\n```\n\n### Female\n\nSe crea una nueva variable binaria llamada *female* para identificar a aquellas personas que:\n\n-   En la variable sexo se identifican como mujeres\n-   En la variable sexo no se identifican como mujeres\n\n```{r}\n# Crear variable binaria: female\ndata <- mutate(data,\n               female=if_else(sexo==2,1,0))\n\n# Tabla de frecuencias y porcentajes\nsjt.xtab(data$female,data$ola,\n         show.col.prc=TRUE, \n         var.labels=c(\"Female\",\"Ola\"),\n         show.summary=FALSE,\n         title=\"Frecuencias y porcentajes de Trabajadoras, por ola\") \n```\n\n## Valoración Movimiento de Demandas Laborales\n\nConsiderando la pregunta de ELSOC:\n\n-   c20. Pensando en la lista de movimientos sociales que a continuación le mostraré, por favor indique ¿cuál es el que usted más valora?\n\nSi consideramos **solamente** a las personas que responden que el movimiento que más valoran es el de \"Movimiento social de apoyo a demandas laborales\" tenemos:\n\n```{r}\ntabla_freq_mov_laboral <- data %>%\n  group_by(ola) %>%\n  summarise(n_mov_laboral = sum(mov_valora==2), \n            n_ola = n(),\n            prop = n_mov_laboral/n_ola)\n\nkable(tabla_freq_mov_laboral, caption = \"Frecuencia de respuestas 'Movimiento social de apoyo a demandas laborales'\")\n```\n\nEl porcentaje más bajo de respuestas positivas se dio el año 2018 con un 6.08% y el más alto el año 2021 con un 16.75%. En promedio corresponde al 10.87% de la muestra.\n\n### Dummy\n\nSe crea una nueva variable binaria llamada *valora-lab* para identificar a aquellas personas que:\n\n-   Valoran el \"Movimiento social de apoyo a demandas laborales\"\n-   No valoran el \"Movimiento social de apoyo a demandas laborales\"\n\n```{r}\n# Crear variable binaria: open-ended\ndata <- mutate(data,\n               valora_lab=if_else(mov_valora==2,1,0))\n\n# Tabla de frecuencias y porcentajes\nsjt.xtab(data$valora_lab,data$ola,\n         show.col.prc=TRUE, \n         var.labels=c(\"Valora-Lab\",\"Ola\"),\n         show.summary=FALSE,\n         title=\"Frecuencias y porcentajes de Trabajadores/as permanentes, por ola\") \n```\n\nEsta variable tiene una serie de ítems asociados al nivel de acuerdo con afirmaciones respecto al movimiento social que más se valora.\n\n-   c21. Pensando en \\[movimiento social que más valora\\], ¿cuán de acuerdo o en desacuerdo está usted con las siguientes afirmaciones?\n\n-   c21_01. Siento un compromiso con este movimiento\n\n```{r}\n# Recodificar\ndata <- data %>%\n  mutate(compromiso_mov=car::recode(c21_01,\n                                    recodes=c(\"1='Totalmente en desacuerdo';\n                                               2='En desacuerdo';\n                                               3='Ni en desacuerdo ni de acuerdo';\n                                               4='De acuerdo';\n                                               5='Totalmente de acuerdo';\n                                               -888=NA; \n                                               -999=NA\"),\n                                    as.factor = TRUE, # convertir a factor\n                                    levels = c(\"Totalmente en desacuerdo\",\n                                               \"En desacuerdo\",\n                                               \"Ni en desacuerdo ni de acuerdo\",\n                                               \"De acuerdo\",\n                                               \"Totalmente de acuerdo\"))) # ordenar niveles\n\n# Tabla de frecuencias y porcentajes\ndata_ml <- data %>% \n  filter(mov_valora==2)\n\nsjt.xtab(data_ml$compromiso_mov,data_ml$ola,\n         show.col.prc = TRUE,\n         var.labels = c(\"Compromiso con el movimiento DL\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes del Nivel de Compromiso con el Movimiento de Demandas Laborales, por ola\")\n```\n\n### Intervalo: compromiso\n\nSe crea una nueva variable de intervalo llamada *compromiso-lab* para identificar a aquellas personas que:\n\n-   0 = No valoran el \"Movimiento social de apoyo a demandas laborales\"\n-   1 = Totalmente en desacuerdo con compromiso al \"Movimiento social de apoyo a demandas laborales\"\n-   2 = En desacuerdo con compromiso al \"Movimiento social de apoyo a demandas laborales\"\n-   3 = Ni en desacuerdo ni de acuerdo con compromiso al \"Movimiento social de apoyo a demandas laborales\"\n-   4 = De acuerdo con compromiso al \"Movimiento social de apoyo a demandas laborales\"\n-   5 = Totalmente de acuerdo con compromiso al \"Movimiento social de apoyo a demandas laborales\"\n\n```{r}\n# Crear variable binaria: open-ended\ndata <- mutate(data,\n               valora_lab=if_else(mov_valora==2,1,0))\n\n# Tabla de frecuencias y porcentajes\nsjt.xtab(data$valora_lab,data$ola,\n         show.col.prc=TRUE, \n         var.labels=c(\"Valora-Lab\",\"Ola\"),\n         show.summary=FALSE,\n         title=\"Frecuencias y porcentajes de Trabajadores/as permanentes, por ola\") \n```\n\n-   c21_02. Me identifico con este movimiento\n\n```{r}\n# Recodificar\ndata <- data %>%\n  mutate(identificacion_mov=car::recode(c21_02,\n                                        recodes=c(\"1='Totalmente en desacuerdo';\n                                                   2='En desacuerdo';\n                                                   3='Ni en desacuerdo ni de acuerdo';\n                                                   4='De acuerdo';\n                                                   5='Totalmente de acuerdo';\n                                                   -888=NA; \n                                                   -999=NA\"),\n                                        as.factor=TRUE, # convertir a factor\n                                        levels=c(\"Totalmente en desacuerdo\",\n                                                 \"En desacuerdo\",\n                                                 \"Ni en desacuerdo ni de acuerdo\",\n                                                 \"De acuerdo\",\n                                                 \"Totalmente de acuerdo\"))) # ordenar niveles\n\n# Tabla de frecuencias y porcentajes\ndata_ml <- data %>% \n  filter(mov_valora==2)\n\nsjt.xtab(data_ml$identificacion_mov,data_ml$ola,\n         show.col.prc = TRUE,\n         var.labels = c(\"Identificación con el movimiento DL\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes del Nivel de Identificación con el Movimiento de Demandas Laborales, por ola\")\n```\n\n-   c21_05. Las acciones y protestas de este movimiento pueden generar un cambio social\n\n```{r}\n# Recodificar\ndata <- data %>%\n  mutate(acciones_mov=car::recode(c21_05,\n                                  recodes=c(\"1='Totalmente en desacuerdo';\n                                             2='En desacuerdo';\n                                             3='Ni en desacuerdo ni de acuerdo';\n                                             4='De acuerdo';\n                                             5='Totalmente de acuerdo';\n                                             -888=NA; \n                                             -999=NA\"),\n                                  as.factor=TRUE, # convertir a factor\n                                  levels=c(\"Totalmente en desacuerdo\",\n                                           \"En desacuerdo\",\n                                           \"Ni en desacuerdo ni de acuerdo\",\n                                           \"De acuerdo\",\n                                           \"Totalmente de acuerdo\"))) # ordenar niveles\n\n# Tabla de frecuencias y porcentajes\ndata_ml <- data %>% \n  filter(mov_valora==2)\n\nsjt.xtab(data_ml$acciones_mov,data_ml$ola,\n         show.col.prc = TRUE,\n         var.labels = c(\"Acciones movimiento DL pueden generar cambio social\",\"Ola\"),\n         show.summary = FALSE,\n         title = \"Frecuencias y porcentajes del Nivel de Acuerdo con acciones del Movimiento de Demandas Laborales generan cambio social, por ola\")\n```\n\n-   c21_09. Las autoridades y el movimiento tienen posiciones opuestas\n\n```{r}\n# Recodificar\ndata <- data %>%\n  mutate(opuesta_mov=car::recode(c21_09,\n                                 recodes=c(\"1='Totalmente en desacuerdo';\n                                            2='En desacuerdo';\n                                            3='Ni en desacuerdo ni de acuerdo';\n                                            4='De acuerdo';\n                                            5='Totalmente de acuerdo';\n                                            -888=NA; \n                                            -999=NA\"),\n                                 as.factor=TRUE, # convertir a factor\n                                 levels=c(\"Totalmente en desacuerdo\",\n                                          \"En desacuerdo\",\n                                          \"Ni en desacuerdo ni de acuerdo\",\n                                          \"De acuerdo\",\n                                          \"Totalmente de acuerdo\"))) # ordenar niveles\n\n# Calcular frecuencias\ntabla_freq_opuesta_ml <- data %>%\n  filter(mov_valora==2) %>%\n  group_by(ola,opuesta_mov) %>%\n  summarise(frecuencia=n()) %>%\n  ungroup() \n\n# Crear tabla en formato wide\ntabla_freq_opuesta_ml <- tabla_freq_opuesta_ml %>%\n  pivot_wider(names_from=ola,values_from=frecuencia,names_prefix=\"Ola_\")\n\n# Mostrar tabla\nkable(tabla_freq_opuesta_ml,caption=\"Frecuencias de 'Grado de acuerdo: Posición opuesta entre el movimiento y las autoridades' por ola\")\n```\n\n-   c22. Ahora, pensando en los últimos 12 meses, cuán frecuntemente ha participado usted en \\[movimiento social que más valora\\]\n\n```{r}\n# Recodificar\ndata <- data %>%\n  mutate(participacion_mov=car::recode(c22,\n                                       recodes=c(\"1='Nunca';\n                                                  2='Casi nunca';\n                                                  3='A veces';\n                                                  4='Frecuentemente';\n                                                  5='Muy Frecuentemente';\n                                                  -888=NA; \n                                                  -999=NA\"),\n                                       as.factor=TRUE, # convertir a factor\n                                       levels=c(\"Nunca\",\n                                                \"Casi nunca\",\n                                                \"A veces\",\n                                                \"Frecuentemente\",\n                                                \"Muy Frecuentemente\"))) # ordenar niveles\n\n# Calcular frecuencias\ntabla_freq_participacion_ml <- data %>%\n  filter(mov_valora==2) %>%\n  group_by(ola,participacion_mov) %>%\n  summarise(frecuencia=n()) %>%\n  ungroup() \n\n# Crear tabla en formato wide\ntabla_freq_participacion_ml <- tabla_freq_participacion_ml %>%\n  pivot_wider(names_from=ola,values_from=frecuencia,names_prefix=\"Ola_\")\n\n# Mostrar tabla\nkable(tabla_freq_participacion_ml,caption=\"Frecuencias de 'Frecuencia: Participación en el movimiento' por ola\")\n\n```\n\n## Participación en sindicatos\n\n-   c12_04. Membresía sindicatos\n\n```{r}\n# Recodficar\ndata <- data %>%\n  mutate(mem_sindicato=car::recode(c12_04,\n                                   recodes=c(\"1='No es miembro';\n                                              2='Miembro inactivo';\n                                              3='Miembro activo';\n                                              -888=NA; \n                                              -999=NA\"),\n                                   as.factor=TRUE, # convertir a factor\n                                   levels=c(\"No es miembro\",\n                                            \"Miembro inactivo\",\n                                            \"Miembro activo\"))) # ordenar niveles\n\n# Calcular frecuencias\ntabla_freq_mem_sindicato <- data %>%\n  group_by(ola,mem_sindicato) %>%\n  summarise(frecuencia=n()) %>%\n  ungroup() \n\n# Crear tabla en formato wide\ntabla_freq_mem_sindicato <- tabla_freq_mem_sindicato %>%\n  pivot_wider(names_from=ola,values_from=frecuencia,names_prefix=\"Ola_\")\n\n# Mostrar tabla\nkable(tabla_freq_mem_sindicato,caption=\"Frecuencias de cada categoría de Membresía Sindicatos por ola considerando toda la muestra\")\n```\n\n```{r}\ntabla_freq_mem_sindicato_ml <- data %>%\n  filter(mov_valora==2) %>%\n  group_by(ola,mem_sindicato) %>%\n  summarise(frecuencia=n()) %>%\n  ungroup() \n\n# Crear tabla en formato wide\ntabla_freq_mem_sindicato_ml <- tabla_freq_mem_sindicato_ml %>%\n  pivot_wider(names_from=ola,values_from=frecuencia,names_prefix=\"Ola_\")\n\n# Mostrar tabla\nkable(tabla_freq_mem_sindicato_ml,caption=\"Frecuencias de Membresía Sindicato por ola, para quienes valoran movimientos laborales\")\n```\n\n## Participación en huelgas\n\n-   c08_03. Durante los últimos 12 meses, con cuánta frecuencia usted ha participado en una huelga\n\n```{r}\n# Recodficar\ndata <- data %>%\n  mutate(part_huelga=car::recode(c08_03,\n                                 recodes=c(\"1='Nunca';\n                                            2='Casi nunca';\n                                            3='A veces';\n                                            4='Frecuentemente';\n                                            5='Muy Frecuentemente';\n                                            -888=NA; \n                                            -999=NA\"),\n                                 as.factor=TRUE, # convertir a factor\n                                 levels=c(\"Nunca\",\n                                          \"Casi nunca\",\n                                          \"A veces\",\n                                          \"Frecuentemente\",\n                                          \"Muy Frecuentemente\"))) # ordenar niveles\n\n# Calcular frecuencias\ntabla_freq_part_huelga <- data %>%\n  group_by(ola,part_huelga) %>%\n  summarise(frecuencia=n()) %>%\n  ungroup() \n\n# Crear tabla en formato wide\ntabla_freq_part_huelga <- tabla_freq_part_huelga %>%\n  pivot_wider(names_from=ola,values_from=frecuencia,names_prefix=\"Ola_\")\n\n# Mostrar tabla\nkable(tabla_freq_part_huelga,caption=\"Frecuencias de cada categoría de Participación en huelga por ola considerando toda la muestra\")\n```\n\n```{r}\ntabla_freq_part_huelga_ml <- data %>%\n  filter(mov_valora==2) %>%\n  group_by(ola,part_huelga) %>%\n  summarise(frecuencia=n()) %>%\n  ungroup() \n\n# Crear tabla en formato wide\ntabla_freq_part_huelga_ml <- tabla_freq_part_huelga_ml %>%\n  pivot_wider(names_from=ola,values_from=frecuencia,names_prefix=\"Ola_\")\n\n# Mostrar tabla\nkable(tabla_freq_part_huelga_ml,caption=\"Frecuencias de Participación en huelga por ola, para quienes valoran movimientos laborales\")\n```\n\n```{r}\ntabla_freq_part_huelga_ps <- data %>%\n  filter(c12_04==2|c12_04==3) %>%\n  group_by(ola,part_huelga) %>%\n  summarise(frecuencia=n()) %>%\n  ungroup() \n\n# Crear tabla en formato wide\ntabla_freq_part_huelga_ps <- tabla_freq_part_huelga_ps %>%\n  pivot_wider(names_from=ola,values_from=frecuencia,names_prefix=\"Ola_\")\n\n# Mostrar tabla\nkable(tabla_freq_part_huelga_ps,caption=\"Frecuencias de Participación en huelga por ola, para quienes son miembros de sindicatos (activos o inactivos)\")\n```\n\n## Interés en política\n\n-   c13. ¿Qué tan interesado está usted en la política?\n\n```{r}\n# Recodficar\ndata <- data %>%\n  mutate(int_politica=car::recode(c13,\n                                  recodes=c(\"1='Nada interesado';\n                                             2='Poco interesado';\n                                             3='Algo interesado';\n                                             4='Bastante interesado';\n                                             5='Muy interesado';\n                                             -888=NA; \n                                             -999=NA\"),\n                                  as.factor=TRUE, # convertir a factor\n                                  levels=c(\"Nada interesado\",\n                                           \"Poco interesado\",\n                                           \"Algo interesado\",\n                                           \"Bastante interesado\",\n                                           \"Muy interesado\"))) # ordenar niveles\n\n# Calcular frecuencias\ntabla_freq_int_politica <- data %>%\n  group_by(ola,int_politica) %>%\n  summarise(frecuencia=n()) %>%\n  ungroup() \n\n# Crear tabla en formato wide\ntabla_freq_int_politica <- tabla_freq_int_politica %>%\n  pivot_wider(names_from=ola,values_from=frecuencia,names_prefix=\"Ola_\")\n\n# Mostrar tabla\nkable(tabla_freq_int_politica,caption=\"Frecuencias de cada categoría de Interés en la política por ola considerando toda la muestra\")\n```\n\n```{r}\ntabla_freq_int_politica_ml <- data %>%\n  filter(mov_valora==2) %>%\n  group_by(ola,int_politica) %>%\n  summarise(frecuencia=n()) %>%\n  ungroup() \n\n# Crear tabla en formato wide\ntabla_freq_int_politica_ml <- tabla_freq_int_politica_ml %>%\n  pivot_wider(names_from=ola,values_from=frecuencia,names_prefix=\"Ola_\")\n\n# Mostrar tabla\nkable(tabla_freq_int_politica_ml,caption=\"Frecuencias de Interés en la política por ola, para quienes valoran movimientos laborales\")\n```\n\n```{r}\ntabla_freq_int_politica_ps <- data %>%\n  filter(c12_04==2|c12_04==3) %>%\n  group_by(ola,int_politica) %>%\n  summarise(frecuencia=n()) %>%\n  ungroup() \n\n# Crear tabla en formato wide\ntabla_freq_int_politica_ps <- tabla_freq_int_politica_ps %>%\n  pivot_wider(names_from=ola,values_from=frecuencia,names_prefix=\"Ola_\")\n\n# Mostrar tabla\nkable(tabla_freq_int_politica_ps,caption=\"Frecuencias de Interés en la política por ola, para quienes son miembros de sindicatos (activos o inactivos)\")\n```\n\n## Guardar base\n\n```{r}\nsave(data,file=(here::here(\"output/elsoc-huelgas.Rdata\")))\nsaveRDS(data,file=(here::here(\"output/elsoc-huelgas.rds\")))\n```\n\n\n# SIN ATRICIÓN Exploración y preparación de datos \n\nTambién, crearemos una base de datos que contenga solamente a aquellos/as encuestados/as que hayan participado en todas las olas, esto quiere decir, sin atrición. La llamaremos data_sa.\n\n```{r,echo=FALSE}\ndata_sa <- data %>%\n  filter(tipo_atricion==1)\n```\n\n```{r,echo=FALSE}\nn_sa <- nrow(data_sa)\n```\n\nLa base de datos sin atrición comienza con `r n_sa` observaciones.\n\n\n### Actividad principal S/A\n\n-   `m02`. ¿Cuál de estas situaciones describe mejor su actividad principal durante el último mes?\n\n```{r,echo=FALSE}\n# Recodficar\ndata_sa$actividad <- car::recode(data_sa$m02,\n                                 recodes=c(\"1='Trabaja de manera remunerada con jornada completa';\n                                            2='Trabaja de manera remunerada a tiempo parcial';\n                                            3='Estudia y trabaja';\n                                            4='Solo estudia';\n                                            5='Jubilado o pensionado';\n                                            6='Desempleado, buscando trabajo';\n                                            7='Realiza tareas no remuneradas';\n                                            8='Esta enfermo o tiene una discapacidad';\n                                            9='No estudia, no trabaja y no busca trabajo';\n                                            -888=NA; \n                                            -999=NA\"),\n                                 as.factor=TRUE, \n                                 levels=c(\"Trabaja de manera remunerada con jornada completa\",\n                                          \"Trabaja de manera remunerada a tiempo parcial\",\n                                          \"Estudia y trabaja\",\n                                          \"Solo estudia\",\n                                          \"Jubilado o pensionado\",\n                                          \"Desempleado, buscando trabajo\",\n                                          \"Realiza tareas no remuneradas\",\n                                          \"Esta enfermo o tiene una discapacidad\",\n                                          \"No estudia, no trabaja y no busca trabajo\"))\n\n# Tabla de frecuencias y porcentajes\nsjt.xtab(data_sa$actividad,data_sa$ola,\n         show.col.prc=TRUE, \n         var.labels=c(\"Actividad\",\"Ola\"),\n         show.summary=FALSE,\n         title=\"Frecuencias y porcentajes de Actividad principal, por ola, S/A\") \n```\n\nSe continua con una base de datos filtrada dejando solo a las personas ocupadas de acuerdo con las siguientes categorías de actividad principal:\n\n-   `m02==1`: Trabaja de manera remunerada con jornada completa\n-   `m02==2`: Trabaja de manera remunerada a tiempo parcial\n-   `m03==3`: Estudia y trabaja\n\n```{r,echo=FALSE}\n# Filtrar para ocupados\ndata_sa <- filter(data_sa,actividad %in% c(\"Trabaja de manera remunerada con jornada completa\",\n                                           \"Trabaja de manera remunerada a tiempo parcial\",\n                                           \"Estudia y trabaja\"))\n```\n\n```{r,echo=FALSE}\nn_sa <- nrow(data_sa)\n```\n\nQuedan `r n_sa` observaciones.\n\n### Full-time S/A\n\nSe crea una nueva variable binaria llamada *full-time* para identificar a aquellas personas que:\n\n-   Trabajan de manera remunerada con jornada completa\n-   Trabajan de manera remunerada a tiempo parcial, o trabajan y estudian\n\n```{r,echo=FALSE}\n# Crear variable binaria: full-time\ndata_sa <- mutate(data_sa,\n                  full_time=if_else(actividad==\"Trabaja de manera remunerada con jornada completa\",1,0))\n\n# Tabla de frecuencias y porcentajes\nsjt.xtab(data_sa$full_time,data_sa$ola,\n         show.col.prc=TRUE, \n         var.labels=c(\"Full-time\",\"Ola\"),\n         show.summary=FALSE,\n         title=\"Frecuencias y porcentajes de Trabajadores/as con jornada completa, por ola, S/A\") \n```\n\n### Relación de empleo S/A\n\n-   `m07`. En su actual ocupación usted trabaja como:\n\n```{r}\n# Recodficar\ndata_sa <- data_sa %>%\n  mutate(rel_empleo=car::recode(m07,\n                                recodes=c(\"1='Empleado u obrero en empresa privada';\n                                           2='Empleado u obrero del sector público';\n                                           3='Miembro de las Fuerzas Armadas y de Orden';\n                                           4='Patrón/a o empleador/a';\n                                           5='Trabaja solo, no tiene empleados';\n                                           6='Familiar no remunerado';\n                                           7='Servicio doméstico';\n                                           -888=NA; \n                                           -999=NA\"),\n                                as.factor=TRUE, # convertir a factor\n                                levels=c(\"Empleado u obrero en empresa privada\",\n                                         \"Empleado u obrero del sector público\",\n                                         \"Miembro de las Fuerzas Armadas y de Orden\",\n                                         \"Patrón/a o empleador/a\",\n                                         \"Trabaja solo, no tiene empleados\",\n                                         \"Familiar no remunerado\",\n                                         \"Servicio doméstico\"))) # ordenar niveles\n\n# Tabla de frecuencias y porcentajes 2 dígitos\nsjt.xtab(data_sa$rel_empleo,data_sa$ola,\n         show.col.prc=TRUE,\n         var.labels=c(\"Relación de empleo\",\"Ola\"),\n         show.summary=FALSE,\n         title=\"Frecuencias y porcentajes de la Relación de empleo, por ola\")\n```\n\nLa variable de relación de empleo (`rel_empleo` ex `m07`), solamente está presente en las olas 2016, 2018 y 2021. Por lo tanto, se duplicarán los datos de relación de empleo para los años siguientes, es decir, en 2017 se pondrán los valores de 2016, y así sucesivamente.\n\n```{r}\n# Crear una columna con la variable \"actividad\" adelantada una ola\ndata_sa <- data_sa %>%\n  # arrange(idencuesta, ola) %>%  # Ordena por id y ola, por si acaso no está ordenado\n  group_by(idencuesta) %>%        # Agrupa por id para trabajar en cada individuo\n  mutate(rel_empleo_lagged=lag(as.character(rel_empleo),n=1)) %>%  # Desplaza \"rel_empleo\" a la siguiente ola, \n                                                                   # conviertiendo el factor en character temporalmente\n  ungroup()\n\n# Rellenar los valores NA en la variable original\ndata_sa <- data_sa %>%\n  mutate(rel_empleo=ifelse(is.na(rel_empleo),rel_empleo_lagged,as.character(rel_empleo))) %>%  # Si rel empleo es NA, sustituir con el valor de la ola anterior y asegurarse que actividad esté en formato carácter\n  mutate(rel_empleo=factor(rel_empleo)) %>%  # Convertir de nuevo a factor\n  select(-rel_empleo_lagged)                 # Elimina la columna temporal\n\n# Tabla de frecuencias y porcentajes \nsjt.xtab(data_sa$rel_empleo,data_sa$ola,\n         show.col.prc=TRUE,\n         var.labels=c(\"Relación de empleo\",\"Ola\"),\n         show.summary=FALSE,\n         title=\"Frecuencias y porcentajes de la Relación de empleo, por ola, S/A\")\n```\n\nSe continua con una base de datos filtrada dejando solo a las personas ocupadas empleadas o auto empleadasde acuerdo con las siguientes categorías de la relación de empleo:\n\n-   m07==1: Empleado u obrero en empresa privada\n-   m07==2: Empleado u obrero del sector público\n-   m07==5: Trabaja solo, no tiene empleados\n-   m07==6: Familiar no remunerado\n-   m07==7: Servicio doméstico\n\nDejando afuera:\n\n-   m07==3: Miembro de las Fuerzas Armadas y de Orden\n-   m07==4: Patrón/a o empleador/a\n\n```{r}\n# Filtrar para trabajadores y self-employed\ndata_sa <- filter(data_sa,rel_empleo %in% c(\"Empleado u obrero en empresa privada\",\n                                            \"Empleado u obrero del sector público\",\n                                            \"Trabaja solo, no tiene empleados\",\n                                            \"Familiar no remunerado\",\n                                            \"Servicio doméstico\"))\n```\n\nQuedan 5.735 observaciones.\n\n```{r}\ndim(data_sa)\n```\n\n\n## Guardar base\n\n```{r}\nsave(data_sa,file=(here::here(\"output/elsoc-huelgas-sa.Rdata\")))\nsaveRDS(data_sa,file=(here::here(\"output/elsoc-huelgas-sa.rds\")))\n```\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"01-exploracion.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","bibliography":["references.bib"],"theme":"cosmo"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"01-exploracion.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"block-headings":true,"bibliography":["references.bib"],"documentclass":"scrreprt"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}